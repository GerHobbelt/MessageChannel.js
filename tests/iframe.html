<!DOCTYPE html>
<html>
<head>
  <title>iFrame</title>
</head>
<body>
  <p>This is an iFrame</p>
  <button>Communicate</button>
  <script type="text/javascript">
    var destinationUrl = "http://localhost:8000",
        button = document.querySelector('button');
    var loadHandler = function(){
      var mc, portMessageHandler;
      mc = new MessageChannel();

      var clickHandler = function(){
        var msg = 'Email added';
        mc.port1.postMessage(msg);
      }
      button.addEventListener('click',clickHandler,false);

      // Send a port to our parent document.
      window.parent.postMessage('documentAHasLoaded', destinationUrl,[mc.port2]);
      // Define our message event handler.
      portMessageHandler = function(portMsgEvent){
        var t = document.createTextNode(event.data);
        document.body.appendChild(t);
      }
      // Set up our port event listener.
      mc.port1.addEventListener('message', portMessageHandler, false);
      // Open the port
      mc.port1.start();
    }
    window.addEventListener('DOMContentLoaded', loadHandler, false);
  </script>
</body>
</html>

