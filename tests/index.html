<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>QUnit Example</title>
  <link rel="stylesheet" href="qunit/qunit.css">
</head>
<body>
  <div id="qunit"></div>
  <script src="qunit/qunit.js"></script>
  <script src="message_channel_test.js"></script>

  <button>Communicate</button>
  <script type="text/javascript">
    var destinationUrl = "http://localhost:8001",
        button = document.querySelector('button');
    var loadHandler = function(){
      // Define our message handler.
      var messageHandler = function(messageEvent){
        // Our form submission handler
        var clickHandler = function(){
          var msg = 'add <foo@example.com> to game circle.';
          messageEvent.ports[0].postMessage(msg);
        }
        button.addEventListener('click',clickHandler,false);

        // Define our message event handler.
        portMessageHandler = function(portMsgEvent){
          var t = document.createTextNode(event.data);
          document.body.appendChild(t);
        }
        // Set up our port event listener.
        messageEvent.ports[0].addEventListener('message', portMessageHandler, false);
        // Open the port
        messageEvent.ports[0].start();
      }


      // Listen for the message from iframe[0]
      window.addEventListener('message',messageHandler,false);
    }
    window.addEventListener('DOMContentLoaded',loadHandler,false);
  </script>
  <iframe id="iFrame" src="http://localhost:8001/tests/iframe.html">
  </iframe>
</body>
</html>
